<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>mongodb备份还原</title>
      <link href="/2020/04/03/mongo%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F/"/>
      <url>/2020/04/03/mongo%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">filename&#x3D;&#96;date +%Y-%m-%d-%H-%M-%S.zip&#96;;</span><br><span class="line">mongodump --host 127.0.0.1:3306 -u root -p &quot;password&quot; --authenticationDatabase admin -d dmce -o &#x2F;data&#x2F;mongo-dump&#x2F;$&#123;filename&#125;</span><br><span class="line">zip -q -r $&#123;filename&#125;.zip &#x2F;data&#x2F;mongo-dump&#x2F;$&#123;filename&#125;</span><br></pre></td></tr></table></figure><h1 id="还原"><a href="#还原" class="headerlink" title="还原"></a>还原</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongorestore --host 127.0.0.1:3306 --drop --username root --password &quot;password&quot; --authenticationDatabase admin --db dmce &#x2F;data&#x2F;data&#x2F;mongo-dump&#x2F;2&#x2F;dmce</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mongodb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker部署eggjs实战</title>
      <link href="/2020/04/03/docker%E9%83%A8%E7%BD%B2node%E5%85%A8%E6%A0%88/"/>
      <url>/2020/04/03/docker%E9%83%A8%E7%BD%B2node%E5%85%A8%E6%A0%88/</url>
      
        <content type="html"><![CDATA[<h1 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h1><h2 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h2><p><code>mysql8.x</code>、<code>mongodb4.2.x</code>、<code>eggjs服务</code>、文件服务、若干 nginx 映射静态服务</p><h2 id="数据量"><a href="#数据量" class="headerlink" title="数据量"></a>数据量</h2><p>mongodb:40G+<br>mysql: 50G+</p><p>mysql 中涉及大量 CPU 密集计算，内存占用也很高<br>eggjs 有一些定时服务，耗时长、内存高（上传数据到亚马逊、从物流公司抓取轨迹等）</p><h2 id="硬件条件"><a href="#硬件条件" class="headerlink" title="硬件条件"></a>硬件条件</h2><p>服务器 x 1=阿里云 C5,4U8G</p><blockquote><p>其实还买过一台 t5(1U2G)运行数据库,一台 mn4(2U8G)运行 egg 服务、文件服务、nginx。但是这些服务器都是共享计算型，CPU 的计算消耗积分，每小时计算能力及其有限。在正式的环境中根本不够看，所以更换了一台 C5（成本所限，不能随心所欲）</p></blockquote><h2 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h2><ol><li>服务的密集计算尽量不要互相影响</li><li>为内存消耗大户设置占用上限，已到达自动 GC</li><li>可快速迁移（等服务器有了之后）</li><li>可快速水平扩容</li></ol><h1 id="安装-docker"><a href="#安装-docker" class="headerlink" title="安装 docker"></a>安装 docker</h1><h2 id="卸载旧版本"><a href="#卸载旧版本" class="headerlink" title="卸载旧版本"></a>卸载旧版本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-selinux \</span><br><span class="line">                  docker-engine-selinux \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure><h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils \</span><br><span class="line">           device-mapper-persistent-data \</span><br><span class="line">           lvm2</span><br></pre></td></tr></table></figure><h2 id="配置-docker-源"><a href="#配置-docker-源" class="headerlink" title="配置 docker 源"></a>配置 docker 源</h2><blockquote><p>这里使用的是国内源</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line">sed -i &#39;s&#x2F;download.docker.com&#x2F;mirrors.ustc.edu.cn\&#x2F;docker-ce&#x2F;g&#39; &#x2F;etc&#x2F;yum.repos.d&#x2F;docker-ce.repo</span><br></pre></td></tr></table></figure><p>官方源:(不推荐)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br></pre></td></tr></table></figure><h2 id="升级-containerd-io"><a href="#升级-containerd-io" class="headerlink" title="升级 containerd.io"></a>升级 containerd.io</h2><blockquote><p>安装新版 docker 需要 containerd.io&gt;1.2.2-3,系统自带版本过低，需要先升级</p></blockquote><p><a href="https://download.docker.com/linux/centos/7/x86_64/stable/Packages/" target="_blank" rel="noopener">在这里下载新版</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;7&#x2F;x86_64&#x2F;stable&#x2F;Packages&#x2F;containerd.io-1.2.6-3.3.el7.x86_64.rpm</span><br><span class="line">yum install containerd.io-1.2.6-3.3.el7.x86_64.rpm</span><br></pre></td></tr></table></figure><h2 id="执行安装-使用脚本"><a href="#执行安装-使用脚本" class="headerlink" title="执行安装(使用脚本)"></a>执行安装(使用脚本)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL get.docker.com -o get-docker.sh</span><br><span class="line"># 使用阿里云镜像</span><br><span class="line">sh get-docker.sh --mirror Aliyun</span><br></pre></td></tr></table></figure><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable docker</span><br><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure><h2 id="建立用户组"><a href="#建立用户组" class="headerlink" title="建立用户组"></a>建立用户组</h2><blockquote><p>安装完毕后会提示: Adding a user to the “docker” group will grant the ability to run containers which can be used to obtain root privileges on the docker host.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd docker</span><br><span class="line">usermod -aG docker $USER</span><br></pre></td></tr></table></figure><h2 id="配置国内镜像仓库"><a href="#配置国内镜像仓库" class="headerlink" title="配置国内镜像仓库"></a>配置国内镜像仓库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;docker&#x2F;daemon.json</span><br><span class="line"># 写入</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [</span><br><span class="line">    &quot;https:&#x2F;&#x2F;dockerhub.azk8s.cn&quot;,</span><br><span class="line">    &quot;https:&#x2F;&#x2F;hub-mirror.c.163.com&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后重启服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><h2 id="配置内核参数"><a href="#配置内核参数" class="headerlink" title="配置内核参数"></a>配置内核参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tee -a &#x2F;etc&#x2F;sysctl.conf &lt;&lt;-EOF</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables &#x3D; 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables &#x3D; 1</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>重载</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><h2 id="数据服务"><a href="#数据服务" class="headerlink" title="数据服务"></a>数据服务</h2><blockquote><p><code>mysql</code>、<code>mongodb</code>、<code>redis</code></p></blockquote><ol><li>这些服务不需要自己构建镜像,使用官方镜像即可</li><li>同时容器也没必要持久保存,停止即删除,启动即创建</li><li>mysql、mongodb 必须使用已有数据目录</li><li>mysql 必须加载已有配置文件</li><li>mysql、mongodb 有外网访问需求(开发排查故障)</li><li>redis 不需要提供外网服务,也不需要在宿主机中访问,仅在 egg 服务镜像中访问</li></ol><h2 id="egg-服务"><a href="#egg-服务" class="headerlink" title="egg 服务"></a>egg 服务</h2><ol><li>需要自己构建镜像</li><li>每次更新不一定非要安装依赖，所以需要两个阶段镜像：依赖镜像和代码镜像</li><li>容器需要持久保存,便于查看日志</li><li>需要安装 alinode 监控服务</li><li>进行监控检查</li><li>不需要在宿主机中访问，仅在 nginx 中访问</li></ol><h2 id="文件服务"><a href="#文件服务" class="headerlink" title="文件服务"></a>文件服务</h2><ol><li>现在文件上传都已经托管到了七牛，此服务目前作用仅仅是提供以前上传文件的访问</li><li>几乎不改动，也非常稳定，几乎没有错误。因此这个服务不需要分阶段运行，也不需要持久保存容器</li><li>不需要在宿主机中访问，仅在 nginx 中访问</li></ol><h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><ol><li>必须加载已有配置文件</li><li>需要托管静态目录、动态服务</li><li>不需要容器持久</li></ol><h1 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h1><h2 id="创建虚拟网络"><a href="#创建虚拟网络" class="headerlink" title="创建虚拟网络"></a>创建虚拟网络</h2><blockquote><p>用于控制各容器之间互相连接，如 egg 访问 mysql、mongodb，nginx 访问 egg、文件服务。</p></blockquote><p><code>docker network create -d bridge dmce-net</code></p><p>创建网络后，容器启动时需要加入网络</p><p><code>--network dmce-net</code></p><p>之后就可用容器名称代替 ip，例如 egg 配置数据库访问地址：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">host: &#39;mysql-1&#39;,</span><br><span class="line">port: 3306</span><br></pre></td></tr></table></figure><p>注意：通过虚拟网络将直接连接容器，而不是宿主机，所以端口指的是容器内部的端口而不是容器映射到宿主机的端口</p><h2 id="egg-依赖的-Dockerfile"><a href="#egg-依赖的-Dockerfile" class="headerlink" title="egg 依赖的 Dockerfile"></a>egg 依赖的 Dockerfile</h2><blockquote><p>不用阶段创建方式，而是把依赖独立为一个镜像。这样在之后的服务拆分中，可以重复使用</p></blockquote><p><code>egg-package.Dockerfile</code></p><p><strong>构建上下文为 egg 服务目录（确保目录中没有 node_modules，否则容器将变得很大），镜像名 <code>egg-package</code></strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 使用alpine系，自带yarn</span><br><span class="line">FROM node:13.12.0-alpine3.11</span><br><span class="line"># 创建服务目录</span><br><span class="line">RUN mkdir -p &#x2F;usr&#x2F;src&#x2F;node-app \</span><br><span class="line"># 安装alinode，为使用阿里云node监控服务准备</span><br><span class="line">  &amp;&amp; npm install nodeinstall -g \</span><br><span class="line">  &amp;&amp; nodeinstall --install-alinode v5.15.0</span><br><span class="line"></span><br><span class="line"># 仅复制安装依赖需要的文件</span><br><span class="line">COPY .&#x2F;package.json &#x2F;usr&#x2F;src&#x2F;node-app&#x2F;package.json</span><br><span class="line">COPY .&#x2F;yarn.lock &#x2F;usr&#x2F;src&#x2F;node-app&#x2F;yarn.lock</span><br><span class="line">COPY .&#x2F;.npmrc &#x2F;usr&#x2F;src&#x2F;node-app&#x2F;.npmrc</span><br><span class="line"></span><br><span class="line"># 工作目录指定</span><br><span class="line">WORKDIR &#x2F;usr&#x2F;src&#x2F;node-app</span><br><span class="line"># 安装依赖</span><br><span class="line">RUN yarn</span><br></pre></td></tr></table></figure><h2 id="egg-服务的-Dockerfile"><a href="#egg-服务的-Dockerfile" class="headerlink" title="egg 服务的 Dockerfile"></a>egg 服务的 Dockerfile</h2><p><code>core-service.Dockerfile</code></p><p><strong>构建上下文为 egg 服务目录（确保目录中没有 node_modules，否则容器将变得很大），镜像名 <code>core-service</code></strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 从egg依赖镜像开始构建</span><br><span class="line">FROM egg-package</span><br><span class="line"># 创建一个数据层，存放服务生成的pdf文件（需要在nginx中映射到域名访问）</span><br><span class="line">VOLUME &#x2F;data&#x2F;pdf&#x2F;order</span><br><span class="line"># 复制代码</span><br><span class="line">COPY .&#x2F; &#x2F;usr&#x2F;src&#x2F;node-app</span><br><span class="line"># 启动</span><br><span class="line">CMD [&quot;yarn&quot;, &quot;start&quot;]</span><br></pre></td></tr></table></figure><h2 id="文件服务的-Dockerfile"><a href="#文件服务的-Dockerfile" class="headerlink" title="文件服务的 Dockerfile"></a>文件服务的 Dockerfile</h2><p><strong>构建上下文为 文件 服务目录（确保目录中没有 node_modules，否则容器将变得很大），镜像名 <code>file-service</code></strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FROM node:13.12.0-alpine3.11</span><br><span class="line">RUN mkdir -p &#x2F;usr&#x2F;src&#x2F;node-app</span><br><span class="line">COPY .&#x2F; &#x2F;usr&#x2F;src&#x2F;node-app</span><br><span class="line">VOLUME &#x2F;usr&#x2F;src&#x2F;node-app&#x2F;file</span><br><span class="line">WORKDIR &#x2F;usr&#x2F;src&#x2F;node-app</span><br><span class="line">RUN yarn</span><br><span class="line">CMD [&quot;node&quot;, &quot;file-server.js&quot;]</span><br></pre></td></tr></table></figure><h2 id="shell-脚本"><a href="#shell-脚本" class="headerlink" title="shell 脚本"></a>shell 脚本</h2><blockquote><p>shell 脚本用来快速管理服务</p></blockquote><h3 id="支持命令一览："><a href="#支持命令一览：" class="headerlink" title="支持命令一览："></a>支持命令一览：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">0：停止并启动mysql服务 1：停止mysql服务</span><br><span class="line">---------------</span><br><span class="line">2：停止并启动mongodb服务 3：停止mongodb服务</span><br><span class="line">---------------</span><br><span class="line">4：停止并启动redis服务 5：停止redis服务</span><br><span class="line">---------------</span><br><span class="line">6：更新service代码和依赖            7：启动service服务       8：停止service服务</span><br><span class="line">9：输出service镜像日志             10：输出service框架日志  11：输出service服务日志 12：输出service错误日志</span><br><span class="line">13：更新service代码并重启[丢失日志] 14：进入service容器</span><br><span class="line">---------------</span><br><span class="line">15：更新客户端代码</span><br><span class="line">---------------</span><br><span class="line">16：创建&#x2F;停止并启动文件服务 17：停止并启动文件服务 18：停止文件服务</span><br><span class="line">---------------</span><br><span class="line">19：停止并启动公用nginx服务  20：停止公用nginx服务</span><br><span class="line">---------------</span><br></pre></td></tr></table></figure><h3 id="脚本内容"><a href="#脚本内容" class="headerlink" title="脚本内容"></a>脚本内容</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;sh</span><br><span class="line"></span><br><span class="line"># 每个命令执行都延迟5秒，留出后悔时间</span><br><span class="line">time_out&#x3D;5</span><br><span class="line"></span><br><span class="line"># 各服务参数配置</span><br><span class="line"># 包括使用内存、交换内存、CPU、CPU分数、端口以及是否持久容器</span><br><span class="line"># 注意：交换内存参数&#x3D;内存+交换内存</span><br><span class="line"># 注意：CPU按数字编号，从0开始</span><br><span class="line"># 注意：CPU分数越大，权重越高，默认都是1024</span><br><span class="line">mysql_memory&#x3D;2G</span><br><span class="line">mysql_memory_swap&#x3D;4G</span><br><span class="line">mysql_cpu&#x3D;0,1</span><br><span class="line">mysql_cpu_share&#x3D;1024</span><br><span class="line">mysql_port&#x3D;3308</span><br><span class="line">mysql_rm&#x3D;--rm</span><br><span class="line"></span><br><span class="line">mongo_memory&#x3D;2G</span><br><span class="line">mongo_memory_swap&#x3D;4G</span><br><span class="line">mongo_cpu&#x3D;0,1</span><br><span class="line">mongo_cpu_share&#x3D;512</span><br><span class="line">mongo_port&#x3D;3306</span><br><span class="line">mongo_rm&#x3D;--rm</span><br><span class="line"></span><br><span class="line">redis_memory&#x3D;300M</span><br><span class="line">redis_memory_swap&#x3D;1G</span><br><span class="line">redis_cpu&#x3D;2</span><br><span class="line">redis_cpu_share&#x3D;512</span><br><span class="line">redis_rm&#x3D;--rm</span><br><span class="line"></span><br><span class="line">core_service_memory&#x3D;2G</span><br><span class="line">core_service_memory_swap&#x3D;4G</span><br><span class="line">core_service_cpu&#x3D;2,3</span><br><span class="line">core_service_cpu_share&#x3D;1024</span><br><span class="line">core_service_rm&#x3D;</span><br><span class="line"></span><br><span class="line">file_service_memory&#x3D;500M</span><br><span class="line">file_service_memory_swap&#x3D;1G</span><br><span class="line">file_service_cpu&#x3D;2</span><br><span class="line">file_service_cpu_share&#x3D;512</span><br><span class="line">file_service_rm&#x3D;--rm</span><br><span class="line"></span><br><span class="line">nginx_service_memory&#x3D;300M</span><br><span class="line">nginx_service_memory_swap&#x3D;1G</span><br><span class="line">nginx_service_cpu&#x3D;2</span><br><span class="line">nginx_service_cpu_share&#x3D;1024</span><br><span class="line">nginx_service_rm&#x3D;--rm</span><br><span class="line"></span><br><span class="line"># 后悔缓冲函数</span><br><span class="line">function dotime()&#123;</span><br><span class="line">  for i in &#96;seq -w $time_out -1 1&#96;</span><br><span class="line">    do</span><br><span class="line">      echo -e &quot;$i秒后执行 \c&quot;</span><br><span class="line">      for j in $(seq 1 $i)</span><br><span class="line">      do</span><br><span class="line">      if [ $j &#x3D; $i ]; then</span><br><span class="line">      echo &quot;后悔来得及&quot;</span><br><span class="line">      else</span><br><span class="line">      echo -e &quot;后悔来得及  \c&quot;</span><br><span class="line">      fi</span><br><span class="line">      done</span><br><span class="line">      sleep 1</span><br><span class="line">  done</span><br><span class="line">  echo &quot;来不及了~~~&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># mysql容器创建函数</span><br><span class="line">function startMysql()&#123;</span><br><span class="line">  # 无论如何都先停止</span><br><span class="line">  docker stop mysql-1</span><br><span class="line">  docker run \</span><br><span class="line">  # 挂载配置文件</span><br><span class="line">  -v &#x2F;data&#x2F;docker&#x2F;my.cnf:&#x2F;etc&#x2F;mysql&#x2F;conf.d&#x2F;my.cnf:ro \</span><br><span class="line">  # 挂载数据目录</span><br><span class="line">  -v &#x2F;data&#x2F;mysql:&#x2F;var&#x2F;lib&#x2F;mysql \</span><br><span class="line">  # 除了最终服务启动用户，其余都用root</span><br><span class="line">  --user root \</span><br><span class="line">  # 端口映射，这里不加IP表示映射到所有IP</span><br><span class="line">  -p $mysql_port:3306 \</span><br><span class="line">  # 容器名称</span><br><span class="line">  --name mysql-1 \</span><br><span class="line">  # d&#x3D;后台运行</span><br><span class="line">  -d \</span><br><span class="line">  # 内存限制</span><br><span class="line">  -m $mysql_memory \</span><br><span class="line">  # 交换内存限制&#x3D;内存+交换内存</span><br><span class="line">  --memory-swap $mysql_memory_swap \</span><br><span class="line">  # cpu限制</span><br><span class="line">  --cpuset-cpus $mysql_cpu \</span><br><span class="line">  # cpu分数</span><br><span class="line">  --cpu-shares $mysql_cpu_share \</span><br><span class="line">  # 持久or临时容器</span><br><span class="line">  $mysql_rm \</span><br><span class="line">  # 加入虚拟网络</span><br><span class="line">  --network dmce-net \</span><br><span class="line">  mysql:8.0.19</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># mongo 容器创建</span><br><span class="line">function startMongodb()&#123;</span><br><span class="line">  docker stop mongo-1</span><br><span class="line">  docker run \</span><br><span class="line">  --name mongo-1 \</span><br><span class="line">  -v &#x2F;data&#x2F;mongo:&#x2F;data&#x2F;db \</span><br><span class="line">  --user root \</span><br><span class="line">  -p $mongo_port:27017 \</span><br><span class="line">  -dit \</span><br><span class="line">  -m $mongo_memory \</span><br><span class="line">  --memory-swap $mongo_memory_swap \</span><br><span class="line">  --cpuset-cpus $mongo_cpu \</span><br><span class="line">  --cpu-shares $mongo_cpu_share \</span><br><span class="line">  $mongo_rm \</span><br><span class="line">  --network dmce-net \</span><br><span class="line">  mongo:4.2.5-bionic \</span><br><span class="line">  # mongo 自身内存限制</span><br><span class="line">  --wiredTigerCacheSizeGB 1.5 \</span><br><span class="line">  # 绑定所有ip</span><br><span class="line">  --bind_ip_all \</span><br><span class="line">  # 最大连接数</span><br><span class="line">  --maxConns 1000 \</span><br><span class="line">  # 需要授权访问</span><br><span class="line">  --auth</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># redis 容器创建</span><br><span class="line">function startRedis()&#123;</span><br><span class="line">  docker stop redis-1</span><br><span class="line">  docker run \</span><br><span class="line">  --name redis-1 \</span><br><span class="line">  -d \</span><br><span class="line">  -m $redis_memory \</span><br><span class="line">  --memory-swap $redis_memory_swap \</span><br><span class="line">  --cpuset-cpus $redis_cpu \</span><br><span class="line">  --cpu-shares $redis_cpu_share \</span><br><span class="line">  $redis_rm \</span><br><span class="line">  --network dmce-net \</span><br><span class="line">  redis</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 构建egg依赖镜像</span><br><span class="line">function buildEggService()&#123;</span><br><span class="line">  cd &#x2F;data&#x2F;services&#x2F;dmce-erp</span><br><span class="line">  git pull</span><br><span class="line">  docker image rm egg-package</span><br><span class="line">  echo &quot;【注意：】此镜像需要安装node依赖,安装完成后,docker要整理文件碎片,会有一段时间等待&quot;</span><br><span class="line">  docker build \</span><br><span class="line">  # 镜像名称</span><br><span class="line">  -t egg-package \</span><br><span class="line">  # 指定dockerfile</span><br><span class="line">  -f &#x2F;data&#x2F;docker&#x2F;egg-package.Dockerfile \</span><br><span class="line">  # 指定上下文</span><br><span class="line">  &#x2F;data&#x2F;services&#x2F;dmce-erp&#x2F;service-dist</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 构建 egg服务镜像</span><br><span class="line">function buildCoreService()&#123;</span><br><span class="line">  cd &#x2F;data&#x2F;services&#x2F;dmce-erp</span><br><span class="line">  git pull</span><br><span class="line">  docker stop core-service-1</span><br><span class="line">  docker rm core-service-1</span><br><span class="line">  docker build \</span><br><span class="line">  -t core-service \</span><br><span class="line">  -f &#x2F;data&#x2F;docker&#x2F;core-service.Dockerfile \</span><br><span class="line">  &#x2F;data&#x2F;services&#x2F;dmce-erp&#x2F;service-dist</span><br><span class="line">&#125;</span><br><span class="line"># 启动egg服务容器</span><br><span class="line">function startCoreService()&#123;</span><br><span class="line">  docker stop core-service-1</span><br><span class="line">  docker rm core-service-1</span><br><span class="line">  docker run \</span><br><span class="line">  --name core-service-1 \</span><br><span class="line">  -v &#x2F;data&#x2F;pdf&#x2F;order:&#x2F;data&#x2F;pdf&#x2F;order \</span><br><span class="line">  -d \</span><br><span class="line">  -m $core_service_memory \</span><br><span class="line">  --memory-swap $core_service_memory_swap \</span><br><span class="line">  --cpuset-cpus $core_service_cpu \</span><br><span class="line">  --cpu-shares $core_service_cpu_share \</span><br><span class="line">  --network dmce-net \</span><br><span class="line">  $core_service_rm \</span><br><span class="line">  core-service</span><br><span class="line">&#125;</span><br><span class="line"># 启动文件服务容器</span><br><span class="line">function startFileService()&#123;</span><br><span class="line">  docker stop file-service-1</span><br><span class="line">  docker run \</span><br><span class="line">  --name file-service-1 \</span><br><span class="line">  -v &#x2F;data&#x2F;services&#x2F;file-services&#x2F;files:&#x2F;data&#x2F;services&#x2F;file-services&#x2F;files \</span><br><span class="line">  -d \</span><br><span class="line">  -m $file_service_memory \</span><br><span class="line">  --memory-swap $file_service_memory_swap \</span><br><span class="line">  --cpuset-cpus $file_service_cpu \</span><br><span class="line">  --cpu-shares $file_service_cpu_share \</span><br><span class="line">  $file_service_rm \</span><br><span class="line">  --network dmce-net \</span><br><span class="line">  file-service</span><br><span class="line">&#125;</span><br><span class="line"># 构建文件服务镜像</span><br><span class="line">function buildFileService()&#123;</span><br><span class="line">  docker stop file-service-1</span><br><span class="line">  docker image rm file-service</span><br><span class="line">  docker build \</span><br><span class="line">  -t file-service \</span><br><span class="line">  -f &#x2F;data&#x2F;docker&#x2F;file-service.Dockerfile \</span><br><span class="line">  &#x2F;data&#x2F;services&#x2F;dmce-erp&#x2F;file-service</span><br><span class="line">  startFileService</span><br><span class="line">&#125;</span><br><span class="line"># 启动nginx容器</span><br><span class="line">function startNginx()&#123;</span><br><span class="line">  docker stop nginx-1</span><br><span class="line">  docker run \</span><br><span class="line">  --name nginx-1 \</span><br><span class="line">  -dit \</span><br><span class="line">  # 挂载配置文件</span><br><span class="line">  -v &#x2F;data&#x2F;docker&#x2F;nginx.conf:&#x2F;etc&#x2F;nginx&#x2F;nginx.conf:ro \</span><br><span class="line">  # 挂载静态目录</span><br><span class="line">  -v &#x2F;data&#x2F;valid-files:&#x2F;data&#x2F;valid-files:ro \</span><br><span class="line">  -v &#x2F;data&#x2F;pdf:&#x2F;data&#x2F;pdf:ro \</span><br><span class="line">  -v &#x2F;data&#x2F;site&#x2F;blog:&#x2F;data&#x2F;site&#x2F;blog:ro \</span><br><span class="line">  -v &#x2F;data&#x2F;site&#x2F;jingrise.com:&#x2F;data&#x2F;site&#x2F;jingrise.com:ro \</span><br><span class="line">  -v &#x2F;data&#x2F;docker&#x2F;cert:&#x2F;etc&#x2F;nginx&#x2F;cert:ro \</span><br><span class="line">  $nginx_service_rm \</span><br><span class="line">  -p 80:80 \</span><br><span class="line">  -p 443:443 \</span><br><span class="line">  -m $nginx_service_memory \</span><br><span class="line">  --memory-swap $nginx_service_memory_swap \</span><br><span class="line">  --cpuset-cpus $nginx_service_cpu \</span><br><span class="line">  --cpu-shares $nginx_service_cpu_share \</span><br><span class="line">  --network dmce-net \</span><br><span class="line">  nginx</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo &quot;-----------------------&quot;</span><br><span class="line">echo &quot;|    部署辅助脚本      |&quot;</span><br><span class="line">echo &quot;-----------------------&quot;</span><br><span class="line">read -p &quot;请输入命令:</span><br><span class="line">0：停止并启动mysql服务 1：停止mysql服务</span><br><span class="line">---------------</span><br><span class="line">2：停止并启动mongodb服务 3：停止mongodb服务</span><br><span class="line">---------------</span><br><span class="line">4：停止并启动redis服务 5：停止redis服务</span><br><span class="line">---------------</span><br><span class="line">6：更新service代码和依赖            7：启动service服务       8：停止service服务</span><br><span class="line">9：输出service镜像日志             10：输出service框架日志  11：输出service服务日志 12：输出service错误日志</span><br><span class="line">13：更新service代码并重启[丢失日志] 14：进入service容器</span><br><span class="line">---------------</span><br><span class="line">15：更新客户端代码</span><br><span class="line">---------------</span><br><span class="line">16：创建&#x2F;停止并启动文件服务 17：停止并启动文件服务 18：停止文件服务</span><br><span class="line">---------------</span><br><span class="line">19：停止并启动公用nginx服务  20：停止公用nginx服务</span><br><span class="line">---------------</span><br><span class="line">请输入要做何操作? &quot; type</span><br><span class="line"></span><br><span class="line">echo $type</span><br><span class="line"></span><br><span class="line">if [ $type &#x3D; &#39;0&#39; ]; then</span><br><span class="line">  echo &quot;您选择了 [0：停止并启动mysql服务]&quot;</span><br><span class="line">  dotime</span><br><span class="line">  startMysql</span><br><span class="line">elif [ $type &#x3D; &#39;1&#39; ]; then</span><br><span class="line">  echo &quot;您选择了 [1：停止mysql服务]&quot;</span><br><span class="line">  dotime</span><br><span class="line">  docker stop mysql-1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">elif [ $type &#x3D; &#39;2&#39; ]; then</span><br><span class="line">  echo &quot;您选择了 [2：停止并启动mongodb服务]&quot;</span><br><span class="line">  dotime</span><br><span class="line">  startMongodb</span><br><span class="line">elif [ $type &#x3D; &#39;3&#39; ]; then</span><br><span class="line">  echo &quot;您选择了 [3：停止mongodb服务]&quot;</span><br><span class="line">  dotime</span><br><span class="line">  docker stop mongo-1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">elif [ $type &#x3D; &#39;4&#39; ]; then</span><br><span class="line">  echo &quot;您选择了 [4：停止并启动redis服务]&quot;</span><br><span class="line">  dotime</span><br><span class="line">  startRedis</span><br><span class="line">elif [ $type &#x3D; &#39;5&#39; ]; then</span><br><span class="line">  echo &quot;您选择了 [5：停止redis服务]&quot;</span><br><span class="line">  dotime</span><br><span class="line">  docker stop redis-1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">elif [ $type &#x3D; &#39;6&#39; ]; then</span><br><span class="line">  echo &quot;您选择了 [6：更新service代码和依赖]&quot;</span><br><span class="line">  dotime</span><br><span class="line">  buildEggService</span><br><span class="line">  buildCoreService</span><br><span class="line">  startCoreService</span><br><span class="line">elif [ $type &#x3D; &#39;7&#39; ]; then</span><br><span class="line">  echo &quot;您选择了 [7：启动service服务]&quot;</span><br><span class="line">  dotime</span><br><span class="line">  docker start core-service-1</span><br><span class="line">elif [ $type &#x3D; &#39;8&#39; ]; then</span><br><span class="line">  echo &quot;您选择了 [8：停止service服务]&quot;</span><br><span class="line">  dotime</span><br><span class="line">  docker stop core-service-1</span><br><span class="line">elif [ $type &#x3D; &#39;9&#39; ]; then</span><br><span class="line">  docker logs core-service-1</span><br><span class="line">elif [ $type &#x3D; &#39;10&#39; ]; then</span><br><span class="line">  # 执行容器中命令</span><br><span class="line">  docker exec core-service-1 tail -fn 500 &#x2F;root&#x2F;logs&#x2F;service&#x2F;egg-web.log</span><br><span class="line">elif [ $type &#x3D; &#39;11&#39; ]; then</span><br><span class="line">  docker exec core-service-1 tail -fn 500 &#x2F;root&#x2F;logs&#x2F;service&#x2F;service-web.log</span><br><span class="line">elif [ $type &#x3D; &#39;12&#39; ]; then</span><br><span class="line">  docker exec core-service-1 tail -fn 500 &#x2F;root&#x2F;logs&#x2F;service&#x2F;common-error.log</span><br><span class="line">elif [ $type &#x3D; &#39;13&#39; ]; then</span><br><span class="line">  echo &quot;您选择了 [13：更新service代码并重启[丢失日志]]&quot;</span><br><span class="line">  dotime</span><br><span class="line">  buildCoreService</span><br><span class="line">  startCoreService</span><br><span class="line">elif [ $type &#x3D; &#39;14&#39; ]; then</span><br><span class="line">  echo &quot;您选择了 [14：进入service容器]&quot;</span><br><span class="line">  # 进入容器，i&#x3D;保持可输入命令状态 t&#x3D;打开终端</span><br><span class="line">  docker exec -it core-service-1 sh</span><br><span class="line"></span><br><span class="line">elif [ $type &#x3D; &#39;15&#39; ]; then</span><br><span class="line">  echo &quot;您选择了 [15：更新客户端代码]&quot;</span><br><span class="line">  dotime</span><br><span class="line">  cd &#x2F;data&#x2F;services&#x2F;dmce-erp</span><br><span class="line">  git pull</span><br><span class="line">  docker stop nginx-1</span><br><span class="line">  docker start nginx-1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">elif [ $type &#x3D; &#39;16&#39; ]; then</span><br><span class="line">  echo &quot;您选择了 [16：创建&#x2F;停止并启动文件服务]&quot;</span><br><span class="line">  dotime</span><br><span class="line">  buildFileService</span><br><span class="line">elif [ $type &#x3D; &#39;17&#39; ]; then</span><br><span class="line">  echo &quot;您选择了 [17：停止并启动文件服务]&quot;</span><br><span class="line">  dotime</span><br><span class="line">  startFileService</span><br><span class="line">elif [ $type &#x3D; &#39;18&#39; ]; then</span><br><span class="line">  echo &quot;您选择了 [18：停止文件服务]&quot;</span><br><span class="line">  dotime</span><br><span class="line">  docker stop file-service-1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">elif [ $type &#x3D; &#39;19&#39; ]; then</span><br><span class="line">  echo &quot;您选择了 [19：停止并启动公用nginx服务]&quot;</span><br><span class="line">  dotime</span><br><span class="line">  startNginx</span><br><span class="line">elif [ $type &#x3D; &#39;20&#39; ]; then</span><br><span class="line">  echo &quot;您选择了 [20：停止公用nginx服务]&quot;</span><br><span class="line">  dotime</span><br><span class="line">  docker stop nginx-1</span><br><span class="line"></span><br><span class="line">fi</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql函数大全</title>
      <link href="/2020/04/03/mysql%E5%87%BD%E6%95%B0/"/>
      <url>/2020/04/03/mysql%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h1><h2 id="表结构"><a href="#表结构" class="headerlink" title="表结构"></a>表结构</h2><h3 id="班级-t-class"><a href="#班级-t-class" class="headerlink" title="班级 t_class"></a>班级 t_class</h3><table><thead><tr><th>字段名</th><th>类型</th><th>注释</th></tr></thead><tbody><tr><td>class_id</td><td>int</td><td>班级主键</td></tr><tr><td>class_name</td><td>varchar(32)</td><td>班级名称</td></tr></tbody></table><h3 id="学生表-t-student"><a href="#学生表-t-student" class="headerlink" title="学生表 t_student"></a>学生表 t_student</h3><table><thead><tr><th>字段名</th><th>类型</th><th>注释</th></tr></thead><tbody><tr><td>student_id</td><td>int</td><td>学生主键</td></tr><tr><td>student_name</td><td>varchar(32)</td><td>学生姓名</td></tr><tr><td>class_id</td><td>int</td><td>所在班级主键</td></tr></tbody></table><h3 id="科目-t-subject"><a href="#科目-t-subject" class="headerlink" title="科目 t_subject"></a>科目 t_subject</h3><table><thead><tr><th>字段名</th><th>类型</th><th>注释</th></tr></thead><tbody><tr><td>subject_id</td><td>int</td><td>科目主键</td></tr><tr><td>subject_name</td><td>varchar(32)</td><td>科目姓名</td></tr></tbody></table><h3 id="成绩-t-score"><a href="#成绩-t-score" class="headerlink" title="成绩 t_score"></a>成绩 t_score</h3><table><thead><tr><th>字段名</th><th>类型</th><th>注释</th></tr></thead><tbody><tr><td>subject_id</td><td>int</td><td>科目主键</td></tr><tr><td>student_id</td><td>int</td><td>学生主键</td></tr><tr><td>subject_score</td><td>int</td><td>成绩</td></tr></tbody></table><h2 id="Sql"><a href="#Sql" class="headerlink" title="Sql"></a>Sql</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for t_class</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS &#96;t_class&#96;;</span><br><span class="line">CREATE TABLE &#96;t_class&#96;  (</span><br><span class="line">  &#96;class_id&#96; int(11) NOT NULL COMMENT &#39;班级主键&#39;,</span><br><span class="line">  &#96;class_name&#96; varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT &#39;班级名称&#39;,</span><br><span class="line">  PRIMARY KEY (&#96;class_id&#96;) USING BTREE</span><br><span class="line">) ENGINE &#x3D; InnoDB CHARACTER SET &#x3D; utf8mb4 COLLATE &#x3D; utf8mb4_general_ci ROW_FORMAT &#x3D; Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Records of t_class</span><br><span class="line">-- ----------------------------</span><br><span class="line">INSERT INTO &#96;t_class&#96; VALUES (1, &#39;1班&#39;);</span><br><span class="line">INSERT INTO &#96;t_class&#96; VALUES (2, &#39;2班&#39;);</span><br><span class="line">INSERT INTO &#96;t_class&#96; VALUES (3, &#39;3班&#39;);</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for t_score</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS &#96;t_score&#96;;</span><br><span class="line">CREATE TABLE &#96;t_score&#96;  (</span><br><span class="line">  &#96;subject_id&#96; int(11) NULL DEFAULT NULL COMMENT &#39;科目主键&#39;,</span><br><span class="line">  &#96;student_id&#96; int(11) NULL DEFAULT NULL COMMENT &#39;学生主键&#39;,</span><br><span class="line">  &#96;subject_score&#96; int(11) NULL DEFAULT NULL COMMENT &#39;成绩&#39;</span><br><span class="line">) ENGINE &#x3D; InnoDB CHARACTER SET &#x3D; utf8mb4 COLLATE &#x3D; utf8mb4_general_ci ROW_FORMAT &#x3D; Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Records of t_score</span><br><span class="line">-- ----------------------------</span><br><span class="line">INSERT INTO &#96;t_score&#96; VALUES (1, 1, 67);</span><br><span class="line">INSERT INTO &#96;t_score&#96; VALUES (1, 2, 88);</span><br><span class="line">INSERT INTO &#96;t_score&#96; VALUES (1, 3, 69);</span><br><span class="line">INSERT INTO &#96;t_score&#96; VALUES (1, 4, 89);</span><br><span class="line">INSERT INTO &#96;t_score&#96; VALUES (1, 5, 92);</span><br><span class="line">INSERT INTO &#96;t_score&#96; VALUES (1, 6, 69);</span><br><span class="line">INSERT INTO &#96;t_score&#96; VALUES (1, 8, 75);</span><br><span class="line">INSERT INTO &#96;t_score&#96; VALUES (1, 9, 72);</span><br><span class="line">INSERT INTO &#96;t_score&#96; VALUES (1, 10, 78);</span><br><span class="line">INSERT INTO &#96;t_score&#96; VALUES (2, 1, 84);</span><br><span class="line">INSERT INTO &#96;t_score&#96; VALUES (2, 2, 96);</span><br><span class="line">INSERT INTO &#96;t_score&#96; VALUES (2, 3, 76);</span><br><span class="line">INSERT INTO &#96;t_score&#96; VALUES (2, 4, 89);</span><br><span class="line">INSERT INTO &#96;t_score&#96; VALUES (2, 5, 90);</span><br><span class="line">INSERT INTO &#96;t_score&#96; VALUES (2, 6, 81);</span><br><span class="line">INSERT INTO &#96;t_score&#96; VALUES (2, 8, 76);</span><br><span class="line">INSERT INTO &#96;t_score&#96; VALUES (2, 9, 77);</span><br><span class="line">INSERT INTO &#96;t_score&#96; VALUES (2, 10, 79);</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for t_student</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS &#96;t_student&#96;;</span><br><span class="line">CREATE TABLE &#96;t_student&#96;  (</span><br><span class="line">  &#96;student_id&#96; int(11) NOT NULL COMMENT &#39;学生主键&#39;,</span><br><span class="line">  &#96;student_name&#96; varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT &#39;学生姓名&#39;,</span><br><span class="line">  &#96;class_id&#96; int(11) NULL DEFAULT NULL COMMENT &#39;所在班级主键&#39;,</span><br><span class="line">  PRIMARY KEY (&#96;student_id&#96;) USING BTREE</span><br><span class="line">) ENGINE &#x3D; InnoDB CHARACTER SET &#x3D; utf8mb4 COLLATE &#x3D; utf8mb4_general_ci ROW_FORMAT &#x3D; Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Records of t_student</span><br><span class="line">-- ----------------------------</span><br><span class="line">INSERT INTO &#96;t_student&#96; VALUES (1, &#39;张一&#39;, 1);</span><br><span class="line">INSERT INTO &#96;t_student&#96; VALUES (2, &#39;李二&#39;, 1);</span><br><span class="line">INSERT INTO &#96;t_student&#96; VALUES (3, &#39;牛三&#39;, 1);</span><br><span class="line">INSERT INTO &#96;t_student&#96; VALUES (4, &#39;马四&#39;, 2);</span><br><span class="line">INSERT INTO &#96;t_student&#96; VALUES (5, &#39;刘六&#39;, 2);</span><br><span class="line">INSERT INTO &#96;t_student&#96; VALUES (6, &#39;孙七&#39;, 2);</span><br><span class="line">INSERT INTO &#96;t_student&#96; VALUES (8, &#39;郝八&#39;, 2);</span><br><span class="line">INSERT INTO &#96;t_student&#96; VALUES (9, &#39;李九&#39;, 3);</span><br><span class="line">INSERT INTO &#96;t_student&#96; VALUES (10, &#39;郭十&#39;, 3);</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for t_subject</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS &#96;t_subject&#96;;</span><br><span class="line">CREATE TABLE &#96;t_subject&#96;  (</span><br><span class="line">  &#96;subject_id&#96; int(11) NOT NULL COMMENT &#39;科目主键&#39;,</span><br><span class="line">  &#96;subject_name&#96; varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT &#39;科目姓名&#39;,</span><br><span class="line">  PRIMARY KEY (&#96;subject_id&#96;) USING BTREE</span><br><span class="line">) ENGINE &#x3D; InnoDB CHARACTER SET &#x3D; utf8mb4 COLLATE &#x3D; utf8mb4_general_ci ROW_FORMAT &#x3D; Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Records of t_subject</span><br><span class="line">-- ----------------------------</span><br><span class="line">INSERT INTO &#96;t_subject&#96; VALUES (1, &#39;语文&#39;);</span><br><span class="line">INSERT INTO &#96;t_subject&#96; VALUES (2, &#39;计算机&#39;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> 函数 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql备份还原</title>
      <link href="/2020/04/03/mysql%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F/"/>
      <url>/2020/04/03/mysql%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filename&#x3D;&#96;date +%Y-%m-%d-%H-%M-%S&#96;;</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;mysqldump -ubackup -pbackup dbname --skip-lock-tables | zip &gt; &#x2F;data&#x2F;mysql-dump&#x2F;\$&#123;filename&#125;.zip</span><br></pre></td></tr></table></figure><h1 id="还原"><a href="#还原" class="headerlink" title="还原"></a>还原</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;bin&#x2F;mysql -ubackup -pbackup dbname &lt; &#x2F;data&#x2F;mysql-dump&#x2F;1.sql</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nodejs windows原生模块编译</title>
      <link href="/2020/04/03/nodejs-windows%E5%8E%9F%E7%94%9F%E6%A8%A1%E5%9D%97%E7%BC%96%E8%AF%91/"/>
      <url>/2020/04/03/nodejs-windows%E5%8E%9F%E7%94%9F%E6%A8%A1%E5%9D%97%E7%BC%96%E8%AF%91/</url>
      
        <content type="html"><![CDATA[<h2 id="安装编译工具"><a href="#安装编译工具" class="headerlink" title="安装编译工具"></a>安装编译工具</h2><p><code>npm install --global windows-build-tools</code></p><h2 id="设置本地使用的-msbuild-版本"><a href="#设置本地使用的-msbuild-版本" class="headerlink" title="设置本地使用的 msbuild 版本"></a>设置本地使用的 msbuild 版本</h2><p><code>npm config set msvs_version 2013</code></p>]]></content>
      
      
      <categories>
          
          <category> NodeJs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NodeJs </tag>
            
            <tag> windows-build </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>centos 7.3 从零开始搭建生产环境</title>
      <link href="/2020/04/03/centos-7-3/"/>
      <url>/2020/04/03/centos-7-3/</url>
      
        <content type="html"><![CDATA[<h2 id="硬盘挂载"><a href="#硬盘挂载" class="headerlink" title="硬盘挂载"></a>硬盘挂载</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fdisk -ll</span><br><span class="line"># 分区</span><br><span class="line">fdisk &#x2F;dev&#x2F;vdb1</span><br><span class="line"># 输入n，其余选项用默认值</span><br><span class="line"># 格式化</span><br><span class="line">mkfs.ext4 &#x2F;dev&#x2F;vdb1</span><br><span class="line"># 创建挂载文件夹</span><br><span class="line">mkdir &#x2F;data</span><br><span class="line"># 挂载</span><br><span class="line">mount &#x2F;dev&#x2F;vdb1 &#x2F;data</span><br><span class="line"># 开机自动挂载</span><br><span class="line">vi &#x2F;etc&#x2F;fstab</span><br><span class="line"># 加入</span><br><span class="line">&#x2F;dev&#x2F;vdb&#x2F;dataext4defaults0 0</span><br></pre></td></tr></table></figure><h2 id="安装-nvm-nodejs-pm2-yarn"><a href="#安装-nvm-nodejs-pm2-yarn" class="headerlink" title="安装 nvm/nodejs/pm2/yarn"></a>安装 nvm/nodejs/pm2/yarn</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 安装nvm</span><br><span class="line">curl -o- https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;creationix&#x2F;nvm&#x2F;v0.35.3&#x2F;install.sh | bash</span><br><span class="line"># 安装node10.2.0,此时nvm不可用时重登陆一次终端即可</span><br><span class="line">nvm install 10.2.0</span><br><span class="line">nvm alias default 10.2.0</span><br><span class="line"># 安装全局pm2</span><br><span class="line">npm install pm2 -g</span><br><span class="line"># 安装yarn</span><br><span class="line">curl --silent --location https:&#x2F;&#x2F;dl.yarnpkg.com&#x2F;rpm&#x2F;yarn.repo | sudo tee &#x2F;etc&#x2F;yum.repos.d&#x2F;yarn.repo</span><br><span class="line">curl --silent --location https:&#x2F;&#x2F;rpm.nodesource.com&#x2F;setup_12.x | bash -</span><br><span class="line">sudo yum install yarn</span><br></pre></td></tr></table></figure><h2 id="安装-htop"><a href="#安装-htop" class="headerlink" title="安装 htop"></a>安装 htop</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release -y</span><br><span class="line">yum install htop -y</span><br></pre></td></tr></table></figure><h2 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 基本环境</span><br><span class="line">yum install -y perl perl-Module-Build net-tools autoconf libaio numactl-libs</span><br><span class="line"># https:&#x2F;&#x2F;dev.mysql.com&#x2F;downloads&#x2F;repo&#x2F;yum&#x2F; 找到linux7的最新源下载地址</span><br><span class="line">wget https:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;mysql80-community-release-el7-2.noarch.rpm</span><br><span class="line"># 安装mysql源</span><br><span class="line">yum localinstall mysql80-community-release-el7-2.noarch.rpm</span><br><span class="line"># 检查是否安装成功，出现3行红色的状态表示成功；修改vim &#x2F;etc&#x2F;yum.repos.d&#x2F;mysql-community.repo中的enable可以启用、关闭特定版本的mysql源</span><br><span class="line">yum repolist enabled | grep &quot;mysql.*-community.*&quot;</span><br><span class="line"># 开始安装</span><br><span class="line">yum install mysql-community-server</span><br><span class="line"># 如果出现找不到包的情况，说明有系统默认的源被开启，禁用即可,然后再执行安装命令</span><br><span class="line">yum module disable mysql</span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><blockquote><p>/etc/my.cnf</p></blockquote><p>注意：这里有一些参数已经是最大值，超过此值 字符串将自动截断</p><p>如：group_concat_max_len</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">port&#x3D;3308</span><br><span class="line">socket&#x3D;&#x2F;data&#x2F;mysql&#x2F;mysql.sock</span><br><span class="line">[mysql]</span><br><span class="line">no-beep&#x3D;</span><br><span class="line">[mysqld]</span><br><span class="line">port&#x3D;3308</span><br><span class="line">datadir&#x3D;&#x2F;data&#x2F;mysql</span><br><span class="line">default_authentication_plugin&#x3D;mysql_native_password</span><br><span class="line">default-storage-engine&#x3D;INNODB</span><br><span class="line">sql-mode&#x3D;&quot;STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION&quot;</span><br><span class="line">log-output&#x3D;FILE</span><br><span class="line">general-log&#x3D;0</span><br><span class="line">general_log_file&#x3D;general.log</span><br><span class="line">slow-query-log&#x3D;1</span><br><span class="line">slow_query_log_file&#x3D;slow_query.log</span><br><span class="line">long_query_time&#x3D;10</span><br><span class="line">log-error&#x3D;&#x2F;data&#x2F;mysql&#x2F;err.log</span><br><span class="line">server-id&#x3D;1</span><br><span class="line">lower_case_table_names&#x3D;1</span><br><span class="line">max_connections&#x3D;1000</span><br><span class="line">table_open_cache&#x3D;2000</span><br><span class="line">thread_cache_size&#x3D;10</span><br><span class="line">myisam_max_sort_file_size&#x3D;107374182400</span><br><span class="line">myisam_sort_buffer_size&#x3D;713031680</span><br><span class="line">key_buffer_size&#x3D;8388608</span><br><span class="line">read_buffer_size&#x3D;65536</span><br><span class="line">read_rnd_buffer_size&#x3D;256K</span><br><span class="line">innodb_flush_log_at_trx_commit&#x3D;1</span><br><span class="line">innodb_log_buffer_size&#x3D;1048576</span><br><span class="line">innodb_buffer_pool_size&#x3D;1073741824</span><br><span class="line">innodb_log_file_size&#x3D;50331648</span><br><span class="line">innodb_thread_concurrency&#x3D;9</span><br><span class="line">innodb_autoextend_increment&#x3D;64</span><br><span class="line">innodb_buffer_pool_instances&#x3D;8</span><br><span class="line">innodb_concurrency_tickets&#x3D;5000</span><br><span class="line">innodb_old_blocks_time&#x3D;1000</span><br><span class="line">innodb_open_files&#x3D;300</span><br><span class="line">innodb_stats_on_metadata&#x3D;0</span><br><span class="line">innodb_file_per_table&#x3D;1</span><br><span class="line">back_log&#x3D;80</span><br><span class="line">flush_time&#x3D;0</span><br><span class="line">join_buffer_size&#x3D;256K</span><br><span class="line">max_allowed_packet&#x3D;4M</span><br><span class="line">max_connect_errors&#x3D;100</span><br><span class="line">open_files_limit&#x3D;4161</span><br><span class="line">sort_buffer_size&#x3D;256K</span><br><span class="line">table_definition_cache&#x3D;1400</span><br><span class="line">binlog_row_event_max_size&#x3D;8K</span><br><span class="line">sync_master_info&#x3D;10000</span><br><span class="line">sync_relay_log&#x3D;10000</span><br><span class="line">sync_relay_log_info&#x3D;10000</span><br><span class="line">loose_mysqlx_port&#x3D;33080</span><br><span class="line">group_concat_max_len&#x3D;-1</span><br><span class="line">max_allowed_packet&#x3D;104857600</span><br><span class="line">max_heap_table_size&#x3D;1048576000</span><br><span class="line">tmp_table_size&#x3D;524288000</span><br><span class="line">skip-log-bin</span><br><span class="line">socket&#x3D;&#x2F;data&#x2F;mysql&#x2F;mysql.sock</span><br><span class="line">pid-file&#x3D;&#x2F;data&#x2F;mysql&#x2F;mysqld.pid</span><br><span class="line">#skip-grant-tables</span><br></pre></td></tr></table></figure><h3 id="启动、停止命令"><a href="#启动、停止命令" class="headerlink" title="启动、停止命令"></a>启动、停止命令</h3><p><code>systemctl start mysqld</code>或<code>service mysqld start</code></p><h3 id="开机自启"><a href="#开机自启" class="headerlink" title="开机自启"></a>开机自启</h3><p><code>systemctl enable mysqld.service</code></p><h3 id="密码修改"><a href="#密码修改" class="headerlink" title="密码修改"></a>密码修改</h3><ol><li>首先在 my.cnf 中打开<code>skip-grant-tables</code></li><li>在终端连接<code>mysql</code></li><li>切换数据库:<code>use mysql;</code></li><li>由于<code>skip-grant-tables</code>，所以在执行任何语句前，执行<code>flush privileges;</code></li><li>修改密码策略:<code>SHOW VARIABLES LIKE &#39;validate_password%&#39;;</code>其中<code>validate_password.policy</code>表示密码检测等级，默认是<code>MEDIUM</code>,将他改为<code>LOW</code>:set global validate_password.policy=LOW;</li><li>先将 root 的密码清空:<code>update user set authentication_string=&#39;&#39;,host=&#39;%&#39; where user=&#39;root&#39;;</code></li><li>修改密码<code>ALTER USER &#39;root&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;aaabbb&#39;;</code></li><li><code>flush privileges;</code></li><li>打开云服务器的安全组：3308，然后就可以用 navicat 连接了</li></ol><h2 id="mongodb"><a href="#mongodb" class="headerlink" title="mongodb"></a>mongodb</h2><h3 id="源"><a href="#源" class="headerlink" title="源"></a>源</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 创建mongodb源文件</span><br><span class="line">vim &#x2F;etc&#x2F;yum.repos.d&#x2F;mongodb-org-4.0.6.repo</span><br></pre></td></tr></table></figure><p>文件内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[mongodb-org-4.2]</span><br><span class="line">name&#x3D;MongoDB Repository</span><br><span class="line">baseurl&#x3D;https:&#x2F;&#x2F;repo.mongodb.org&#x2F;yum&#x2F;redhat&#x2F;6&#x2F;mongodb-org&#x2F;4.2&#x2F;x86_64&#x2F;</span><br><span class="line">gpgcheck&#x3D;0</span><br><span class="line">enabled&#x3D;1</span><br><span class="line">gpgkey&#x3D;https:&#x2F;&#x2F;www.mongodb.org&#x2F;static&#x2F;pgp&#x2F;server-4.2.asc</span><br></pre></td></tr></table></figure><p>修改 gpgcheck=0, 省去 gpg 验证</p><p>更新系统环境</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update</span><br></pre></td></tr></table></figure><h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mongodb-org</span><br></pre></td></tr></table></figure><h3 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h3><blockquote><p>/etc/mongod.conf</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: &#x2F;data&#x2F;mongo&#x2F;mongod.log</span><br><span class="line"></span><br><span class="line">storage:</span><br><span class="line">  dbPath: &#x2F;data&#x2F;mongo</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line">  WiredTiger:</span><br><span class="line">    cacheSizeGB: 4</span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  fork: true  # fork and run in background</span><br><span class="line">  pidFilePath: &#x2F;data&#x2F;mongo&#x2F;mongod.pid  # location of pidfile</span><br><span class="line">  timeZoneInfo: &#x2F;usr&#x2F;share&#x2F;zoneinfo</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 3306</span><br><span class="line">  bindIp: 0.0.0.0  # Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">  authorization: enabled</span><br></pre></td></tr></table></figure><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p><code>systemctl start mongod</code>或<code>service mongod start</code></p><h3 id="开机自启-1"><a href="#开机自启-1" class="headerlink" title="开机自启"></a>开机自启</h3><blockquote><p>无法<code>/sbin/chkconfig mongod on</code>自启！！！因为/dev/null 文件权限每次都会被覆盖</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 &#x2F;dev&#x2F;null</span><br><span class="line">systemctl start mongod.service</span><br></pre></td></tr></table></figure><h3 id="密码修改-1"><a href="#密码修改-1" class="headerlink" title="密码修改"></a>密码修改</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 打开终端</span><br><span class="line">mongo --port&#x3D;3306</span><br><span class="line"># 切换数据库</span><br><span class="line">use admin</span><br><span class="line"># 创建用户</span><br><span class="line">db.createUser(&#123;user: &#39;root&#39;, pwd: &#39;123456&#39;, roles: [&#39;root&#39;]&#125;)</span><br><span class="line"># 验证结果</span><br><span class="line">db.auth(用户名，用户密码)</span><br></pre></td></tr></table></figure><p>使用<code>Studio 3T</code>连接数据库,创建 database\专门的用户</p><h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><h3 id="源-1"><a href="#源-1" class="headerlink" title="源"></a>源</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install yum-utils</span><br><span class="line">vim &#x2F;etc&#x2F;yum.repos.d&#x2F;nginx.repo</span><br></pre></td></tr></table></figure><p>文件内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[nginx-stable]</span><br><span class="line">name&#x3D;nginx stable repo</span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;nginx.org&#x2F;packages&#x2F;centos&#x2F;$releasever&#x2F;$basearch&#x2F;</span><br><span class="line">gpgcheck&#x3D;1</span><br><span class="line">enabled&#x3D;1</span><br><span class="line">gpgkey&#x3D;https:&#x2F;&#x2F;nginx.org&#x2F;keys&#x2F;nginx_signing.key</span><br></pre></td></tr></table></figure><h3 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install nginx</span><br></pre></td></tr></table></figure><h3 id="配置-2"><a href="#配置-2" class="headerlink" title="配置"></a>配置</h3><blockquote><p>/etc/nginx/nginx.conf</p></blockquote><p>略</p><h3 id="执行权限"><a href="#执行权限" class="headerlink" title="执行权限"></a>执行权限</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 如果nginx设置了提交body大小太大，提交的数据会先在 &#96;&#x2F;var&#x2F;lib&#x2F;nginx&#x2F;tmp&#x2F;client_body&#x2F;&#96; 中创建临时文件，然后nginx进程来读取这个文件。</span><br><span class="line"># 但是这种方式安装的nginx，没有读取文件的权限</span><br><span class="line"># 这是nginx进程的用户</span><br><span class="line">ps aux | grep &quot;nginx: worker process&quot; | awk &#39;&#123;print $1&#125;&#39;</span><br><span class="line"># 这是&#96;&#x2F;var&#x2F;lib&#x2F;nginx&#96;的用户</span><br><span class="line">sudo ls -al &#x2F;var&#x2F;lib&#x2F;nginx&#x2F;</span><br><span class="line"># 然后将目录权限进行修改,**注意**，不一定是nobody，可以是nginx进程的其他用户</span><br><span class="line">sudo chown -R nobody:nobody &#x2F;var&#x2F;lib&#x2F;nginx&#x2F;</span><br></pre></td></tr></table></figure><h3 id="启动-1"><a href="#启动-1" class="headerlink" title="启动"></a>启动</h3><p><code>systemctl start nginx</code>或<code>service nginx start</code></p><h3 id="开机自启-2"><a href="#开机自启-2" class="headerlink" title="开机自启"></a>开机自启</h3><p><code>systemctl enable nginx.service</code></p><h2 id="git"><a href="#git" class="headerlink" title="git"></a>git</h2><h3 id="源-2"><a href="#源-2" class="headerlink" title="源"></a>源</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 基本环境</span><br><span class="line"># 因为center-os的git版本太老，所以使用第三方源库：https:&#x2F;&#x2F;ius.io&#x2F;GettingStarted&#x2F; ，这里找到ius-release对center7的包(因为centeros可以忽略epel-release)</span><br><span class="line"># 下载安装</span><br><span class="line">wget https:&#x2F;&#x2F;centos7.iuscommunity.org&#x2F;ius-release.rpm</span><br><span class="line"># 安装源</span><br><span class="line">rpm -i ius-release.rpm</span><br><span class="line"># 开始安装,git需要在后面追加2u,表示使用刚才源库的地址</span><br><span class="line">yum install git2u</span><br></pre></td></tr></table></figure><h3 id="配置-3"><a href="#配置-3" class="headerlink" title="配置"></a>配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global credential.helper store</span><br></pre></td></tr></table></figure><p>然后进行 clone、pull 等操作，输入一次用户名密码后，以后无需再次输入了</p><h2 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 基本环境</span><br><span class="line"># 因为center-os的redis版本太老，所以使用第三方源库：https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;remi&#x2F; ，这里找到对center8的包</span><br><span class="line"># 下载安装</span><br><span class="line">yum install https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;remi&#x2F;enterprise&#x2F;remi-release-8.rpm</span><br><span class="line"># 开始安装</span><br><span class="line">yum --enablerepo&#x3D;remi install redis</span><br><span class="line"># 安装之后可以查看创建的文件</span><br><span class="line">rpm -ql redis</span><br><span class="line"># 开机启动</span><br><span class="line">systemctl enable redis.service</span><br></pre></td></tr></table></figure><h3 id="启动、停止命令-1"><a href="#启动、停止命令-1" class="headerlink" title="启动、停止命令"></a>启动、停止命令</h3><p><code>service redis start</code>或者<code>systemctl start redis</code></p><h3 id="开机自启-3"><a href="#开机自启-3" class="headerlink" title="开机自启"></a>开机自启</h3><p><code>systemctl enable redis.service</code></p><h3 id="配置-4"><a href="#配置-4" class="headerlink" title="配置"></a>配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;redis.conf</span><br></pre></td></tr></table></figure><h2 id="java"><a href="#java" class="headerlink" title="java"></a>java</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"># 官网找rpm安装包</span><br><span class="line"># java8 https:&#x2F;&#x2F;www.oracle.com&#x2F;technetwork&#x2F;java&#x2F;javase&#x2F;downloads&#x2F;jdk8-downloads-2133151.html</span><br><span class="line"># 最新 https:&#x2F;&#x2F;www.oracle.com&#x2F;technetwork&#x2F;java&#x2F;javase&#x2F;downloads&#x2F;index.html</span><br><span class="line"># 将安装包上传到服务器</span><br><span class="line"></span><br><span class="line"># 检查是否有旧版java、openjdk</span><br><span class="line"></span><br><span class="line">rpm -qa | grep java</span><br><span class="line"></span><br><span class="line"># 如果有则卸载,例如上面命令输出</span><br><span class="line"></span><br><span class="line">tzdata-java-2014i-1.el7.noarch</span><br><span class="line">java-1.7.0-openjdk-headless-1.7.0.71-2.5.3.1.el7_0.x86_64</span><br><span class="line">java-1.7.0-openjdk-1.7.0.71-2.5.3.1.el7_0.x86_64</span><br><span class="line"></span><br><span class="line"># 表示有3个java需要卸载:</span><br><span class="line"></span><br><span class="line">rpm -e --nodeps tzdata-java-2014i-1.el7.noarch</span><br><span class="line">rpm -e --nodeps java-1.7.0-openjdk-headless-1.7.0.71-2.5.3.1.el7_0.x86_64</span><br><span class="line">rpm -e --nodeps java-1.7.0-openjdk-1.7.0.71-2.5.3.1.el7_0.x86_64</span><br><span class="line"></span><br><span class="line"># 安装</span><br><span class="line"></span><br><span class="line">rpm -ivh jdk-8u191-linux-x64.rpm</span><br><span class="line"></span><br><span class="line"># 配置环境变量：</span><br><span class="line"></span><br><span class="line">vim &#x2F;etc&#x2F;profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 添加内容：</span><br><span class="line"></span><br><span class="line">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;java&#x2F;default</span><br><span class="line">export PATH&#x3D;$JAVA_HOME&#x2F;bin:$PATH</span><br><span class="line">export CLASSPATH&#x3D;.:$JAVA_HOME&#x2F;lib&#x2F;dt.jar:$JAVA_HOME&#x2F;lib&#x2F;tools.jar</span><br><span class="line"></span><br><span class="line"># 使配置生效</span><br><span class="line"></span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure><h1 id="内存优化"><a href="#内存优化" class="headerlink" title="内存优化"></a>内存优化</h1><h2 id="交换内存"><a href="#交换内存" class="headerlink" title="交换内存"></a>交换内存</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># 查看Swap 分区大小</span><br><span class="line">free -m</span><br><span class="line"># 创建目录</span><br><span class="line">mkdir &#x2F;swap</span><br><span class="line">cd &#x2F;swap</span><br><span class="line"># count单位是KB</span><br><span class="line">sudo dd if&#x3D;&#x2F;dev&#x2F;zero of&#x3D;swapfile bs&#x3D;1024 count&#x3D;2000000</span><br><span class="line"># 转换文件为swap文件</span><br><span class="line">sudo mkswap -f swapfile</span><br><span class="line"># 激活文件</span><br><span class="line">sudo swapon swapfile</span><br><span class="line"># 反激活文件</span><br><span class="line">sudo swapoff swapfile</span><br><span class="line"># 永久保持此空间</span><br><span class="line">vi &#x2F;etc&#x2F;fstab</span><br><span class="line"># 加入</span><br><span class="line">&#x2F;swap&#x2F;swapfile &#x2F;swap swap defaults 0 0</span><br><span class="line"></span><br><span class="line"># 虚拟内存与物理内存关系</span><br><span class="line">cat &#x2F;proc&#x2F;sys&#x2F;vm&#x2F;swappiness</span><br><span class="line"></span><br><span class="line"># 此值越大，表示越依赖虚拟内存，取值0-100</span><br><span class="line"># 临时修改</span><br><span class="line">sysctl vm.swappiness&#x3D;10</span><br><span class="line"># 永久修改</span><br><span class="line">vi &#x2F;etc&#x2F;sysctl.conf</span><br><span class="line"># 加入</span><br><span class="line">vm.swappiness&#x3D;20</span><br></pre></td></tr></table></figure><h2 id="交换内存的大小"><a href="#交换内存的大小" class="headerlink" title="交换内存的大小"></a>交换内存的大小</h2><ol><li>原则上是物理内存的 2 倍</li><li>规则 1：物理内存小于 2G=2 倍到 3 倍，2G-8G=1 倍到 2 倍，8-64G=4G 到 1.5 倍 64G 以上=4G 以上</li><li></li></ol><h2 id="用户限制"><a href="#用户限制" class="headerlink" title="用户限制"></a>用户限制</h2><h3 id="查看当前设置"><a href="#查看当前设置" class="headerlink" title="查看当前设置"></a>查看当前设置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ulimit -a</span><br><span class="line"># 设定core文件的最大值，单位为区块。</span><br><span class="line">core file size          (blocks, -c) unlimited</span><br><span class="line"># 程序数据节区的最大值，单位为KB。</span><br><span class="line">data seg size           (kbytes, -d) unlimited</span><br><span class="line">scheduling priority             (-e) 0</span><br><span class="line"># **重要**</span><br><span class="line">file size               (blocks, -f) unlimited</span><br><span class="line">pending signals                 (-i) 31129</span><br><span class="line">max locked memory       (kbytes, -l) 16384</span><br><span class="line"># **重要**</span><br><span class="line">max memory size         (kbytes, -m) unlimited</span><br><span class="line"># **重要**</span><br><span class="line">open files                      (-n) 65535</span><br><span class="line">pipe size            (512 bytes, -p) 8</span><br><span class="line">POSIX message queues     (bytes, -q) 819200</span><br><span class="line">real-time priority              (-r) 0</span><br><span class="line"># **重要**</span><br><span class="line">stack size              (kbytes, -s) 8192</span><br><span class="line">cpu time               (seconds, -t) unlimited</span><br><span class="line"># **重要**</span><br><span class="line">max user processes              (-u) 31129</span><br><span class="line">virtual memory          (kbytes, -v) unlimited</span><br><span class="line">file locks                      (-x) unlimited</span><br></pre></td></tr></table></figure><h3 id="修改进程数"><a href="#修改进程数" class="headerlink" title="修改进程数"></a>修改进程数</h3><p><code>vi /etc/security/limits.d/90-nproc.conf</code></p><h3 id="修改可打开的最大文件数"><a href="#修改可打开的最大文件数" class="headerlink" title="修改可打开的最大文件数"></a>修改可打开的最大文件数</h3><p><code>vi /etc/security/limits.conf</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 开启任务</span><br><span class="line">nohup 命令 &gt; log.log  2&gt;&amp;1 &amp;</span><br><span class="line"># 任务列表</span><br><span class="line">jobs</span><br><span class="line"># 关闭</span><br><span class="line"></span><br><span class="line">gb %n</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> nginx </tag>
            
            <tag> mysql </tag>
            
            <tag> NodeJs </tag>
            
            <tag> redis </tag>
            
            <tag> mongodb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建 maven 私服--by nexus</title>
      <link href="/2015/09/02/%E6%90%AD%E5%BB%BAmaven%E7%A7%81%E6%9C%8D/"/>
      <url>/2015/09/02/%E6%90%AD%E5%BB%BAmaven%E7%A7%81%E6%9C%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h1><h2 id="版本介绍与下载"><a href="#版本介绍与下载" class="headerlink" title="版本介绍与下载"></a>版本介绍与下载</h2><p>官网： <a href="http://www.sonatype.org/nexus/" target="_blank" rel="noopener">http://www.sonatype.org/nexus/</a><br>OSS、Pro、Pro+、Lifecycle、Auditor 版本，各版本区别可参考：<a href="http://www.sonatype.com/nexus/try-compare-buy/compare" target="_blank" rel="noopener">版本比较</a><br>基本的仓库管理（不带权限分配）已经足够使用，所以使用 OSS 版。<br><a href="https://sonatype-download.global.ssl.fastly.net/nexus/oss/nexus-latest-bundle.zip" target="_blank" rel="noopener">下载地址</a><br>注：浏览器里无法下载，应该是大陆 IP 被屏蔽了，使用离线下载工具即可。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>下载后的压缩包上传至 linux 服务器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span></span><br><span class="line">unzip nexus-latest-bundle.zip <span class="comment">#解压</span></span><br><span class="line">rm nexus-latest-bundle.zip <span class="comment">#删除</span></span><br><span class="line">y</span><br><span class="line"><span class="built_in">cd</span> nexus-2.11.2-06/conf <span class="comment">#准备修改端口配置信息</span></span><br><span class="line">vi nexus.properties <span class="comment">#这里端口改为8000；</span></span><br><span class="line"><span class="built_in">cd</span> ../bin/</span><br><span class="line">sh nexus start</span><br></pre></td></tr></table></figure><p>此时提示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">****************************************</span><br><span class="line">WARNING - NOT RECOMMENDED TO RUN AS ROOT</span><br><span class="line">****************************************</span><br><span class="line">If you insist running as root, <span class="keyword">then</span> <span class="built_in">set</span> the environment variable RUN_AS_USER=root before running this script.</span><br></pre></td></tr></table></figure><p>输入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> RUN_AS_USER=root</span><br></pre></td></tr></table></figure><p>此时执行就 OK 了，想永久赋予权限，可以：<br>vi /etc/profile 加入 export RUN_AS_USER=root<br>执行结果：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">****************************************</span><br><span class="line">WARNING - NOT RECOMMENDED TO RUN AS ROOT</span><br><span class="line">****************************************</span><br><span class="line">Starting Nexus OSS...</span><br><span class="line">Started Nexus OSS.</span><br></pre></td></tr></table></figure><p>打开地址：<a href="http://ip:8000/nexus" target="_blank" rel="noopener">http://ip:8000/nexus</a>;<br>点击 login，u/p：admin/admin123</p><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>nexus 包含代理仓库、宿主仓库、仓库组等。</p><p>仓库分为 4 种类型，分别是 group（分组）、hosted（宿主）、proxy（代理）、virtual（虚拟），仓库的类型是 maven1 或者 maven2，此外仓库还有个 policy 属性（策略），表示该仓库为发布（release）版本或者快照（snapshot），最后两列是仓库的状态和路径，图标列表示仓库的健康状态。<br>maven1 已经很少使用，同时 virtual 也是为了将 maven2 格式化为 maven1，因此也不在关注之列。</p><p>默认分组： Public Repositories；<br>包含以下仓库：</p><ul><li>3rd party：策略为 realease 的宿主类型仓库，用来部署无法从公共仓库获得的第三方发布版本构件。</li><li>apache snapshots：策略为 shapshot 的代理仓库，目标是 apache maven 仓库的快照版本构件。</li><li>central:该仓库代理 maven 中央库，策略为 release，只会下载和缓存中央仓库中的发布版本构件。</li><li>Codehaus Snapshots：策略为 shapshot 的代理仓库，目标是 Codehaus maven 仓库的快照版本构件。</li><li>releases:策略为 release 的宿主类型仓库，用来部署内部发布版本构件。</li><li>snapshots：策略为 shapshot 的宿主类型仓库，用来部署内部发布的快照版本构件。</li></ul><p>一般情况下，public Repositories 已经足够使用。</p><h2 id="配置-maven"><a href="#配置-maven" class="headerlink" title="配置 maven"></a>配置 maven</h2><p>修改~/.m2/settings.xml，添加：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 把所有的maven请求全部映射到私服 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://ip:8000/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 添加构件私有仓库、 插件私有仓库--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>http://ip:8000/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>http://ip:8000/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">releases</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">snapshots</span>&gt;</span><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span><span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 启用profile --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">activeProfile</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">activeProfile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此时 maven 可以让本机所有项目都从 nexus 下载.</p><h2 id="部署构件到-nexus"><a href="#部署构件到-nexus" class="headerlink" title="部署构件到 nexus"></a>部署构件到 nexus</h2><p>除了代理仓库，宿主仓库的作用是提供内部的构件或者第三方的构件以供使用。</p><h3 id="使用-maven-部署构件"><a href="#使用-maven-部署构件" class="headerlink" title="使用 maven 部署构件"></a>使用 maven 部署构件</h3><p>pom 配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>http://0.0.0.0:8000/nexus/content/repositories/thirdparty/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>http://0.0.0.0:8000/nexus/content/repositories/thirdparty/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><p>nexus 仓库对于匿名用户是只读的，为了能部署构件，还需要在 settings.xml 中配置认证信息：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">password</span>&gt;</span>1<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">password</span>&gt;</span>1<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br></pre></td></tr></table></figure><p>项目中 mvn clean deploy 后就会发布到 nexus;</p><h3 id="上传第三方构件"><a href="#上传第三方构件" class="headerlink" title="上传第三方构件"></a>上传第三方构件</h3><p>在 3rd party 中的 artifact upload 中操作：<br>上传时需要确认构件坐标，如果该构件是通过 maven 创建的，在 GAV defintion 中选择 From POM，否则就选择 GAV Parameters。<br>定义好坐标后点击 select artifact（s） to upload 选择要上传的构件，单击 Add artifact 按钮将其加入到上传列表。一次可以上传一个主构件和多个附属构件(classifier)，最后单击 upload artifacts 按钮上传.</p><h2 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h2><p>nexus 基于用户、角色、权限、仓库过滤来实现权限控制。<br>用户可以有多个角色，每个角色拥有多个权限，角色还有上下级包容关系。<br>nexus 内置了许多权限，例如 UI-basic ui privileges（访问界面）、UI-Repository browser（浏览仓库界面）、UI-Search（访问快速搜索栏以及搜索页面）、repo-all repositors（read）（读取所有仓库的权限）、repo-all repositors（full control）（完全控制所有仓库的权限）等。<br>还可以自定权限（增加仓库过滤，即 repositor target，利用正则表达式控制运行访问的特定路径；并指定运行访问的仓库）；</p><p>在 security 中可以设置 ldap（目录服务）、权限（privileges）、角色（roles）、用户（users）。</p><p>另外，在每个仓库的 configuration 中可以设置是否公开 url、是否允许上传之类的设置。</p><h2 id="调度任务"><a href="#调度任务" class="headerlink" title="调度任务"></a>调度任务</h2><p>在 administration–&gt;scheduled task 中可以设置调度任务，调度任务可以完成以下任务：</p><ol><li>downliad indexes：为代理仓库下载索引</li><li>empty trash：清空 nexus 回收站</li><li>backup npm metadata database : 备份 npm 数据库</li><li>download nuget feed：更新 nuget feed</li><li>evict unused proxied items from repository caches :删除代理仓库中长期没用的构件缓存</li><li>expire repository caches：清空代理仓库信息缓存</li><li>optimize repository index：优化仓库索引</li><li>publish index：发布仓库索引为 m2eclipse 等其他格式</li><li>Purge Broken Proxied Rubygems Metadata：清空 Rubygems 中失效的数据</li><li>Purge Nexus Timeline：删除时间线文件（该文件用于生成 rss 源）</li><li>Purge Orphaned API Keys：清除不再引用的 api keys</li><li>Rebuild Hosted Rubygems Metadata Files：重建仓库元数据文件 maven-meta-data.xml，同时创建每个文件的 md5 和 sha1.</li><li>Rebuild NuGet Feed：重建 nuget feed</li><li>Rebuild hosted npm metadata ：重建 npm 元数据</li></ol>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> maven </tag>
            
            <tag> nexus </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
